#!/usr/bin/env bash
<<<<<<< HEAD
# Squash current branch to its merge base, and commit using provided commit message.
#
# Usage:
#   squash-branch [base-branch] "commit-message"
#
# If base-branch is not provided, master is used.
=======
# Squash a branch to its merge base, and commit using provided commit message.
#
# Usage:
#   squash-branch [base-branch] [squash-branch] "commit-message"
#
# If base-branch is not provided, master is used.
# If squash-branch is not provided, the current branch is used.
# The squash-branch is always checked out before squashing it.
>>>>>>> cb5950ff2d9cddb6f6b0b6aeb1e1d533d45fd4ef
#

set -e

if [[ $# -lt 1 || $# -gt 2 ]]; then
    echo "Error - Wrong number of arguments"
    exit 1
fi

<<<<<<< HEAD
current_branch=$(git rev-parse --abbrev-ref HEAD)

if [[ $# -eq 1 ]]; then
    base_branch=master
=======
if [[ $# -eq 1 ]]; then
    base_branch=master
    squash_branch=$(git rev-parse --abbrev-ref HEAD)
>>>>>>> cb5950ff2d9cddb6f6b0b6aeb1e1d533d45fd4ef
    message=$1
fi

if [[ $# -eq 2 ]]; then
<<<<<<< HEAD
    base_branch=$1
    message=$2
fi

echo "Current branch: $current_branch"
echo "Base branch:    $base_branch"

git reset $(git merge-base $base_branch $current_branch)
=======
    base_branch=master
    squash_branch=$1
    message=$2
fi

if [[ $# -eq 3 ]]; then
    base_branch=$1
    squash_branch=$2
    message=$3
fi

echo "Squashing branch: $squash_branch"
echo "Base branch:      $base_branch"

echo "Checking out $squash_branch..."
git checkout $squash_branch

git reset $(git merge-base $base_branch $squash_branch)
>>>>>>> cb5950ff2d9cddb6f6b0b6aeb1e1d533d45fd4ef
git add -A
git commit -m "$message"
